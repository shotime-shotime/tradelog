<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>TradeLog - Professional Share Edition</title>
    <script src="stocks.js"></script>
    <style>
        :root { --primary: #0078d4; --success: #28a745; --danger: #dc3545; --bg: #f4f7f9; --gold: #ffd700; --dark: #1a1a1a; }
        body { font-family: 'Segoe UI', 'Meiryo', sans-serif; background: var(--bg); margin: 0; padding: 0; color: #333; }
        .container { max-width: 1000px; margin: auto; padding: 20px; }
        
        /* æœŸé–“ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
        .period-controls { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 15px; }
        .period-nav { display: flex; gap: 5px; margin-bottom: 12px; }
        .period-nav button { flex: 1; padding: 10px; border: none; background: #eee; border-radius: 8px; cursor: pointer; font-weight: bold; color: #666; transition: 0.3s; }
        .period-nav button.active { background: var(--primary); color: white; }
        .jump-controls { display: flex; align-items: center; gap: 10px; }
        .jump-btn { background: var(--dark); color: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; }
        #history-select { padding: 9px; border-radius: 6px; border: 1px solid #ddd; flex-grow: 1; }
        .period-display { text-align: center; font-size: 13px; font-weight: bold; color: var(--primary); margin-top: 10px; background: #eef6fc; padding: 8px; border-radius: 20px; }

        /* ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ */
        .asset-summary-bar { background: var(--dark); color: white; padding: 20px; border-radius: 12px; display: grid; grid-template-columns: 1fr 1fr 2fr; gap: 15px; margin-bottom: 20px; position: sticky; top: 10px; z-index: 100; box-shadow: 0 4px 15px rgba(0,0,0,0.3); border-bottom: 4px solid var(--primary); }
        .asset-summary-bar .item { text-align: center; border-right: 1px solid #444; }
        .asset-summary-bar .item:last-child { border-right: none; }
        .asset-summary-bar label { font-size: 11px; color: #aaa; display: block; margin-bottom: 5px; }
        .asset-summary-bar .value { font-size: 22px; font-weight: bold; }

        /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ»ã‚«ãƒ¼ãƒ‰ */
        section { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 20px; }
        h3 { margin-top: 0; font-size: 15px; border-left: 4px solid var(--primary); padding-left: 10px; margin-bottom: 15px; }
        
        .card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 10px; border-left: 5px solid #ccc; box-shadow: 0 2px 4px rgba(0,0,0,0.03); position: relative; border-top: 1px solid #eee; border-right: 1px solid #eee; border-bottom: 1px solid #eee; transition: 0.2s; }
        .card.win { border-left-color: var(--success); }
        .card.loss { border-left-color: var(--danger); }
        .card-pl { font-size: 18px; font-weight: bold; margin-top: 5px; }
        .pl-plus { color: var(--success); font-weight: bold; }
        .pl-minus { color: var(--danger); font-weight: bold; }

        /* ãƒœã‚¿ãƒ³é¡ */
        .card-actions { position: absolute; top: 12px; right: 12px; display: flex; gap: 5px; }
        .btn-edit { background: #e3f2fd; color: #0288d1; font-size: 11px; padding: 5px 12px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-edit:hover { background: var(--primary); color: white; }
        .btn-delete { background: #ffebee; color: #c62828; font-size: 11px; padding: 5px 12px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-restore { background: var(--primary); color: white; font-size: 11px; padding: 5px 12px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }

        /* å…¥åŠ›ã‚¨ãƒªã‚¢ */
        .edit-form { background: #f9f9f9; padding: 15px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 10px; }
        .form-grid { display: grid; grid-template-columns: 80px 1fr 100px 100px 100px; gap: 8px; margin-bottom: 10px; }
        .btn { padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 12px; }
        .btn-main { background: var(--dark); color: white; width: 100%; margin-top: 10px; font-size: 15px; }
        .btn-sub { background: #eee; color: #333; }
        .btn-add-row { background: #f0f0f0; color: #555; border: 1px solid #ddd; padding: 6px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 11px; }

        input, select, textarea { padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; }
        .edit-form-highlight { border: 2px solid var(--primary) !important; background: #f0f7ff !important; }
        .editing-card { border: 2px solid var(--primary) !important; background: #f0f7ff !important; }
        
        .trash-section { margin-top: 40px; border-top: 2px dashed #ccc; padding-top: 20px; opacity: 0.8; }
        
        /* ç®¡ç†è¨­å®šã‚¹ã‚¿ã‚¤ãƒ« */
        .admin-section { background: #f0f0f0; border: 1px solid #ddd; padding: 15px; border-radius: 12px; margin-top: 20px; }
        .admin-btns { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="period-controls">
        <div class="period-nav">
            <button id="btn-day" class="active" onclick="changeMode('day')">æœ¬æ—¥</button>
            <button id="btn-week" onclick="changeMode('week')">é€±æ¬¡</button>
            <button id="btn-month" onclick="changeMode('month')">æœˆæ¬¡</button>
            <button id="btn-year" onclick="changeMode('year')">å¹´æ¬¡</button>
        </div>
        <div class="jump-controls">
            <button class="jump-btn" onclick="offsetPeriod(-1)">â—€ å‰ã¸</button>
            <select id="history-select" onchange="jumpToHistory(this.value)"></select>
            <button class="jump-btn" onclick="offsetPeriod(1)">æ¬¡ã¸ â–¶</button>
        </div>
        <div id="period-info" class="period-display"></div>
    </div>

    <div class="asset-summary-bar">
        <div class="item"><label id="period-label">æœŸé–“æç›Š</label><div id="dash-period-pl" class="value">0</div></div>
        <div class="item"><label>é€šç®—æç›Š (ç¨å¼•/å«ã¿)</label><div id="dash-total-pl" class="value">0</div></div>
        <div class="item"><label>ä¿æœ‰æ™‚ä¾¡ (å«ã¿æç›Š)</label><div id="dash-holdings-val" class="value" style="color:var(--gold)">0</div><div id="dash-holdings-diff" style="font-size:12px;">(+0)</div></div>
    </div>

    <section>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h3>ğŸ“¦ ä¿æœ‰éŠ˜æŸ„</h3>
            <button class="btn btn-sub" onclick="showHForm()">+ éŠ˜æŸ„è¿½åŠ </button>
        </div>
        <div id="h-editor" style="display:none;" class="edit-form">
            <div class="form-grid">
                <input type="text" id="h-code" placeholder="ã‚³ãƒ¼ãƒ‰" onkeyup="searchStock('h')">
                <input type="text" id="h-name" placeholder="éŠ˜æŸ„å" readonly style="background:#eee">
                <input type="number" id="h-qty" placeholder="æ ªæ•°" step="100" min="0">
                <input type="number" id="h-buy" placeholder="å–å¾—å˜ä¾¡">
                <input type="number" id="h-now" placeholder="ç¾åœ¨å€¤">
            </div>
            <button class="btn btn-main" style="background:var(--success)" id="h-save-btn" onclick="saveHolding()">ä¿æœ‰éŠ˜æŸ„ã‚’ä¿å­˜</button>
            <button class="btn btn-sub" style="width:100%; margin-top:5px;" onclick="hideHForm()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
        <div id="holding-list"></div>
    </section>

    <section id="t-section">
        <h3>ğŸ“‰ ç¢ºå®šæç›Šã®è¨˜éŒ²</h3>
        <div class="edit-form" id="t-form-container">
            <div style="display:grid; grid-template-columns: 140px 100px 1fr 100px; gap:10px; margin-bottom:10px;">
                <input type="date" id="t-date">
                <input type="text" id="t-code" placeholder="ã‚³ãƒ¼ãƒ‰" onkeyup="searchStock('t')">
                <input type="text" id="t-name" readonly style="background:#eee">
                <select id="t-side"><option value="è²·">è²·</option><option value="å£²">å£²</option></select>
            </div>
            <div id="exec-list"></div>
            <button class="btn-add-row" onclick="addRow()">+ ç´„å®šè¡Œã‚’è¿½åŠ </button>
            <textarea id="t-memo" placeholder="ãƒ¡ãƒ¢..." style="width:100%; height:50px; margin-top:10px;"></textarea>
            <button class="btn btn-main" id="btn-t-save" onclick="saveTrade()">ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚’ä¿å­˜</button>
            <button class="btn btn-sub" id="btn-t-cancel" style="display:none; width:100%; margin-top:5px;" onclick="resetTForm()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </section>

    <h3>ğŸ“œ å–å¼•å±¥æ­´</h3>
    <div id="history-list"></div>

    <div class="admin-section">
        <h3>âš™ï¸ ãƒ„ãƒ¼ãƒ«ç®¡ç†</h3>
        <p style="font-size:11px; color:#666;">ãƒ‡ãƒ¼ã‚¿ã¯ã”åˆ©ç”¨ã®ãƒ–ãƒ©ã‚¦ã‚¶ã«ã®ã¿ä¿å­˜ã•ã‚Œã¾ã™ã€‚ä»–ã®äººã¨ãƒ‡ãƒ¼ã‚¿ãŒæ··ã–ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
        <div class="admin-btns">
            <button class="btn btn-sub" onclick="exportData()">ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜(ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—)</button>
            <button class="btn btn-sub" onclick="importData()">ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ(èª­è¾¼)</button>
            <button class="btn-delete" style="padding:8px 12px;" onclick="resetAllData()">å…¨ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–</button>
        </div>
    </div>

    <div class="trash-section">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h3 style="border-left-color:#666; color:#666;">ğŸ—‘ ã‚´ãƒŸç®±</h3>
            <button class="btn-delete" onclick="emptyTrash()">ç©ºã«ã™ã‚‹</button>
        </div>
        <div id="trash-list"></div>
    </div>
</div>

<script>
    let trades = JSON.parse(localStorage.getItem('trade_logs')) || [];
    let holdings = JSON.parse(localStorage.getItem('trade_holdings')) || [];
    let trash = JSON.parse(localStorage.getItem('trade_trash')) || [];
    let hIdx = -1, tIdx = -1, mode = 'day', offset = 0;
    const TAX = 0.20315;

    window.onload = () => { changeMode('day'); resetTForm(); };

    function saveAll() {
        localStorage.setItem('trade_logs', JSON.stringify(trades));
        localStorage.setItem('trade_holdings', JSON.stringify(holdings));
        localStorage.setItem('trade_trash', JSON.stringify(trash));
    }

    function changeMode(m) { mode = m; offset = 0; updatePeriodUI(); }
    function offsetPeriod(d) { offset += d; updatePeriodUI(); }
    function jumpToHistory(v) { offset = parseInt(v); updatePeriodUI(); }

    function updatePeriodUI() {
        document.querySelectorAll('.period-nav button').forEach(b => b.classList.toggle('active', b.id === `btn-${mode}`));
        const sel = document.getElementById('history-select'); sel.innerHTML = "";
        
        const maxLimit = (mode === 'day') ? -60 : -100;

        for (let i = 0; i >= maxLimit; i--) {
            let s = new Date();
            s.setHours(0,0,0,0);

            if (mode === 'day') {
                s.setDate(s.getDate() + i);
            } else if (mode === 'week') {
                s.setDate(s.getDate() - s.getDay() + (i * 7));
            } else if (mode === 'month') {
                s.setMonth(s.getMonth() + i, 1);
            } else if (mode === 'year') {
                s.setFullYear(s.getFullYear() + i, 0, 1);
            }
            
            const y = s.getFullYear();
            const m = s.getMonth() + 1;
            const d = s.getDate();
            const dayName = ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'][s.getDay()];
            let text = "";

            if (i === 0) {
                text = (mode === 'day') ? "ä»Šæ—¥" : "ç¾åœ¨ã®" + (mode==='week'?'é€±':mode==='month'?'æœˆ':'å¹´');
            } else {
                if (mode === 'day') {
                    text = (i >= -7) ? Math.abs(i) + "æ—¥å‰" : `${m}/${d} (${dayName})`;
                } else if (mode === 'week') {
                    text = `${Math.abs(i)}é€±å‰ (${y}/${m}/${d}ã€œ)`;
                } else if (mode === 'month') {
                    text = `${Math.abs(i)}ãƒ¶æœˆå‰ (${y}/${m})`;
                } else if (mode === 'year') {
                    text = `${Math.abs(i)}å¹´å‰ (${y}å¹´)`;
                }
            }
            const opt = document.createElement('option');
            opt.value = i;
            opt.selected = (i === offset);
            opt.textContent = text;
            sel.appendChild(opt);
        }
        syncInputDateWithPeriod();
        render();
    }

    function getRange() {
        let s = new Date(); s.setHours(0,0,0,0);
        let e = new Date(); e.setHours(23,59,59,999);

        if (mode === 'day') {
            s.setDate(s.getDate() + offset);
            e.setDate(e.getDate() + offset);
        } else if (mode === 'week') {
            s.setDate(s.getDate() - s.getDay() + (offset * 7));
            e = new Date(s);
            e.setDate(s.getDate() + 6);
            e.setHours(23,59,59,999);
        } else if (mode === 'month') {
            s.setMonth(s.getMonth() + offset, 1);
            e = new Date(s.getFullYear(), s.getMonth() + 1, 0, 23, 59, 59, 999);
        } else if (mode === 'year') {
            s.setFullYear(s.getFullYear() + offset, 0, 1);
            e.setFullYear(s.getFullYear() + offset, 11, 31, 23, 59, 59, 999);
        }
        return { s, e };
    }

    function syncInputDateWithPeriod() {
        if (tIdx === -1) {
            const range = getRange();
            const year = range.s.getFullYear();
            const month = String(range.s.getMonth() + 1).padStart(2, '0');
            const day = String(range.s.getDate()).padStart(2, '0');
            document.getElementById('t-date').value = `${year}-${month}-${day}`;
        }
    }

    // ãƒ„ãƒ¼ãƒ«ç®¡ç†ç”¨
    function exportData() {
        const data = { trades, holdings, trash };
        const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `TradeLog_Backup_${new Date().toISOString().split('T')[0]}.json`;
        a.click();
    }

    function importData() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.onchange = e => {
            const reader = new FileReader();
            reader.onload = ev => {
                try {
                    const data = JSON.parse(ev.target.result);
                    if(confirm("ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ")) {
                        trades = data.trades || [];
                        holdings = data.holdings || [];
                        trash = data.trash || [];
                        saveAll(); location.reload();
                    }
                } catch(err) { alert("ä¸æ­£ãªãƒ•ã‚¡ã‚¤ãƒ«ã§ã™"); }
            };
            reader.readAsText(e.target.files[0]);
        };
        input.click();
    }

    function resetAllData() {
        if(confirm("å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦åˆæœŸåŒ–ã—ã¾ã™ã‹ï¼Ÿ")) {
            localStorage.clear(); location.reload();
        }
    }

    // åŸºæœ¬æ“ä½œç³»
    function showHForm() { hIdx = -1; document.getElementById('h-editor').style.display='block'; clearH(); render(); }
    function hideHForm() { hIdx = -1; document.getElementById('h-editor').style.display='none'; render(); }
    function clearH() { ['h-code','h-name','h-qty','h-buy','h-now'].forEach(id => document.getElementById(id).value=""); }
    function saveHolding() {
        const d = { code: document.getElementById('h-code').value, name: document.getElementById('h-name').value, qty: parseFloat(document.getElementById('h-qty').value)||0, buyPrice: parseFloat(document.getElementById('h-buy').value)||0, currentPrice: parseFloat(document.getElementById('h-now').value)||0 };
        if(hIdx > -1) holdings[hIdx] = d; else holdings.unshift(d);
        saveAll(); hideHForm();
    }
    function editHolding(i) { hIdx = i; const h = holdings[i]; document.getElementById('h-editor').style.display='block'; document.getElementById('h-code').value=h.code; document.getElementById('h-name').value=h.name; document.getElementById('h-qty').value=h.qty; document.getElementById('h-buy').value=h.buyPrice; document.getElementById('h-now').value=h.currentPrice; window.scrollTo(0,0); render(); }
    function deleteHolding(i) { if(confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) { holdings.splice(i,1); saveAll(); render(); } }

    function addRow(p="", q="", t="entry") {
        const d = document.createElement('div'); d.className = 'form-grid';
        d.innerHTML = `<input type="number" class="e-p" placeholder="å˜ä¾¡" value="${p}"><input type="number" class="e-q" placeholder="æ•°" value="${q}" style="grid-column:span 2"><select class="e-t" style="grid-column:span 2"><option value="entry" ${t==='entry'?'selected':''}>IN</option><option value="exit" ${t==='exit'?'selected':''}>OUT</option></select>`;
        document.getElementById('exec-list').appendChild(d);
    }
    function saveTrade() {
        const ps = document.querySelectorAll('.e-p'), qs = document.querySelectorAll('.e-q'), ts = document.querySelectorAll('.e-t');
        let iV=0, oV=0, execs=[];
        ps.forEach((p,i) => { const pv=parseFloat(p.value)||0, qv=parseFloat(qs[i].value)||0; execs.push({p:pv, q:qv, t:ts[i].value}); if(ts[i].value==='entry') iV+=pv*qv; else oV+=pv*qv; });
        const d = { date: document.getElementById('t-date').value, code: document.getElementById('t-code').value, name: document.getElementById('t-name').value, side: document.getElementById('t-side').value, pl: (document.getElementById('t-side').value==='è²·'?(oV-iV):(iV-oV)), memo: document.getElementById('t-memo').value, execs: execs };
        if(tIdx > -1) trades[tIdx] = d; else trades.unshift(d);
        saveAll(); resetTForm();
    }
    function editTrade(i) { tIdx = i; const t = trades[i]; document.getElementById('t-form-container').classList.add('edit-form-highlight'); document.getElementById('t-date').value=t.date; document.getElementById('t-code').value=t.code; document.getElementById('t-name').value=t.name; document.getElementById('t-side').value=t.side; document.getElementById('t-memo').value=t.memo; document.getElementById('exec-list').innerHTML=""; (t.execs||[]).forEach(e=>addRow(e.p, e.q, e.t)); document.getElementById('btn-t-cancel').style.display="block"; window.scrollTo(0, document.getElementById('t-section').offsetTop-100); render(); }
    function deleteTrade(i) { if(confirm("ã‚´ãƒŸç®±ã¸ï¼Ÿ")) { trash.unshift(trades.splice(i,1)[0]); saveAll(); render(); } }
    function resetTForm() { tIdx = -1; document.getElementById('t-form-container').classList.remove('edit-form-highlight'); syncInputDateWithPeriod(); ['t-code','t-name','t-memo'].forEach(id=>document.getElementById(id).value=""); document.getElementById('exec-list').innerHTML=""; addRow(); document.getElementById('btn-t-cancel').style.display="none"; render(); }
    function restoreTrade(i) { trades.unshift(trash.splice(i,1)[0]); saveAll(); render(); }
    function emptyTrash() { if(confirm("ç©ºã«ã—ã¾ã™ã‹ï¼Ÿ")) { trash = []; saveAll(); render(); } }
    function searchStock(pre) { const c = document.getElementById(pre+'-code').value.trim(); document.getElementById(pre+'-name').value = (typeof STOCK_MASTER !== 'undefined' && STOCK_MASTER[c]) ? STOCK_MASTER[c] : ""; }

    function render() {
        const range = getRange();
        document.getElementById('period-info').innerText = `æœŸé–“: ${range.s.toLocaleDateString()} ã€œ ${range.e.toLocaleDateString()}`;
        let hHtml = "", totalMV = 0, totalFloating = 0;
        holdings.forEach((h, i) => {
            const mv = h.currentPrice * h.qty, pl = mv - (h.buyPrice * h.qty);
            totalMV += mv; totalFloating += pl;
            hHtml += `<div class="card ${pl>=0?'win':'loss'} ${hIdx===i?'editing-card':''}">
                <div class="card-actions"><button class="btn-edit" onclick="editHolding(${i})">ç·¨é›†</button><button class="btn-delete" onclick="deleteHolding(${i})">å‰Šé™¤</button></div>
                <div style="font-size:11px;color:#777">ä¿æœ‰éŠ˜æŸ„</div>
                <div style="font-weight:bold">${h.code} ${h.name} <a href="https://kabutan.jp/stock/?code=${h.code}" target="_blank" style="text-decoration:none;">ğŸ“ˆ</a> / ${h.qty}æ ª</div>
                <div class="card-pl ${pl>=0?'pl-plus':'pl-minus'}">${mv.toLocaleString()}å†† (${pl>=0?'+':''}${pl.toLocaleString()})</div>
            </div>`;
        });
        document.getElementById('holding-list').innerHTML = hHtml;

        let tHtml = "", pNet = 0, tNet = 0, lastDate = "";
        const filteredTrades = trades.map((t, idx) => ({ ...t, originalIdx: idx })).filter(t => { tNet += t.pl; const d = new Date(t.date); return d >= range.s && d <= range.e; }).sort((a, b) => new Date(b.date) - new Date(a.date));
        filteredTrades.forEach((t) => {
            pNet += t.pl;
            if (t.date !== lastDate) {
                const d = new Date(t.date);
                tHtml += `<div style="margin: 20px 0 10px 5px; font-weight: bold; color: #555; border-left: 3px solid var(--primary); padding-left: 8px;">ğŸ“… ${d.toLocaleDateString()}</div>`;
                lastDate = t.date;
            }
            tHtml += `<div class="card ${t.pl>=0?'win':'loss'} ${tIdx===t.originalIdx?'editing-card':''}">
                <div class="card-actions"><button class="btn-edit" onclick="editTrade(${t.originalIdx})">ç·¨é›†</button><button class="btn-delete" onclick="deleteTrade(${t.originalIdx})">å‰Šé™¤</button></div>
                <div style="font-weight:bold">${t.name} (${t.side}) <a href="https://kabutan.jp/stock/?code=${t.code}" target="_blank" style="text-decoration:none;">ğŸ“ˆ</a></div>
                <div class="card-pl ${t.pl>=0?'pl-plus':'pl-minus'}">${t.pl.toLocaleString()}å††</div>
                ${t.memo ? `<div style="font-size:11px; color:#666; margin-top:5px; background:#f0f0f0; padding:6px; border-radius:4px;">ğŸ“ ${t.memo}</div>` : ''}
            </div>`;
        });
        document.getElementById('history-list').innerHTML = tHtml || '<div style="text-align:center; padding:20px; color:#aaa;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
        
        let trHtml = "";
        trash.forEach((t, i) => { trHtml += `<div class="card" style="opacity:0.6"><div class="card-actions"><button class="btn-restore" onclick="restoreTrade(${i})">å¾©å…ƒ</button></div><div>${t.date} ${t.name}</div></div>`; });
        document.getElementById('trash-list').innerHTML = trHtml;

        document.getElementById('dash-period-pl').innerText = pNet.toLocaleString() + "å††";
        document.getElementById('dash-period-pl').className = "value " + (pNet>=0?'pl-plus':'pl-minus');
        const totalTaxed = (tNet > 0 ? tNet * (1 - TAX) : tNet) + totalFloating;
        document.getElementById('dash-total-pl').innerText = Math.floor(totalTaxed).toLocaleString() + "å††";
        document.getElementById('dash-holdings-val').innerText = totalMV.toLocaleString() + "å††";
        document.getElementById('dash-holdings-diff').innerText = `(${totalFloating>=0?'+':''}${totalFloating.toLocaleString()})`;
        document.getElementById('dash-holdings-diff').className = (totalFloating>=0?'pl-plus':'pl-minus');
    }
</script>
</body>
</html>